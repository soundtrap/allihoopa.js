!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("allihoopa",[],e):"object"==typeof exports?exports.allihoopa=e():t.allihoopa=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){window.Allihoopa&&console.warn("window.Allihoopa already defined"),window.Allihoopa=i(1)},function(t,e,i){"use strict";var n=i(2);e.setup=n.setup;var o=i(3);e.authenticate=o.authenticate;var a=i(5);e.upload=a.uploadResource,e.dropUpload=a.dropPiece;var s=i(7);e.DropPiece=s.DropPiece},function(t,e){"use strict";function i(t){if(null!==u)throw new Error("Can not configure the Allihoopa SDK more than once");if(!t)throw new Error("Options to setup() not provided");if(!t.app||"string"!=typeof t.app)throw new Error("Field `app` of configuration is missing or invalid");if(!t.apiKey||"string"!=typeof t.apiKey)throw new Error("Field `apiKey` of configuration is missing or invalid");u=t}function n(){if(null===u)throw new Error("Allihoopa SDK not yet configured; please call setup() first");return u.app}function o(){if(null===u)throw new Error("Allihoopa SDK not yet configured; please call setup() first");return u.apiKey}function a(){return"allihoopa.com"}function s(){return"api.allihoopa.com"}function r(){u=null}var u=null;e.setup=i,e.getApplicationIdentifier=n,e.getAPIKey=o,e.getWebDomain=a,e.getAPIDomain=s,e.clearConfiguration=r},function(t,e,i){"use strict";function n(t){u.clearCookie(o());var e=window.open("https://"+r.getWebDomain()+"/account/login?response_type=token&client_id="+r.getApplicationIdentifier()+"&redirect_type=postmessage","allihoopa_auth","width=420,height=600");if(!e)return console.warn("Could not open the popup window"),void(t&&t(!1));var i,n,s=!1,c=function(){window.removeEventListener("message",i),window.clearInterval(n)},l=function(e){s||(s=!0,t&&t(e))};i=function(t){"allihoopa:"===t.data.substr(0,10)&&(a(t.data.substr(10)),c(),l(!0))},n=window.setInterval(function(){e.closed&&(c(),setInterval(function(){return l(!1)},100))},100),window.addEventListener("message",i,!1)}function o(){return"ah-auth-"+r.getApplicationIdentifier()}function a(t){u.setPersistentCookie(o(),t)}function s(){return u.getCookie(o())}var r=i(2),u=i(4);e.authenticate=n,e.getAuthCookie=s},function(t,e){"use strict";function i(t){if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),i=0;i<e.length;i++){var n=e[i].trim();if(n.substring(0,t.length+1)===t+"=")return decodeURIComponent(n.substring(t.length+1))}return null}function n(t,e){document.cookie=t+"="+encodeURIComponent(e)+";max-age=1209600"}function o(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"}e.getCookie=i,e.setPersistentCookie=n,e.clearCookie=o},function(t,e,i){"use strict";function n(t,e,i){o(1,function(n){if("OK"===n.status){var o=n.data[0];a(o,t,function(t){e("OK"===t.status?{status:"OK",data:o}:t)},function(t){i(t)})}else e(n)})}function o(t,e){var i="\n        mutation ($count: Int!) {\n            uploadUrls(count: $count) {\n                urls\n            }\n        }";r.graphQLQuery(i,{count:t},function(t){e("OK"===t.status?{status:"OK",data:t.data.uploadUrls.urls}:t)})}function a(t,e,i,n){if(!t)throw new Error("No file url");var o=new XMLHttpRequest;o.open("PUT",t),o.setRequestHeader("Content-type"," "),o.onreadystatechange=function(){4===o.readyState&&200===o.status?i({status:"OK",data:null}):4===o.readyState&&i({status:"ERROR",error:new Error("Could not upload file. Status = "+o.status+" "+o.responseText)})},o.upload.onprogress=function(t){t.lengthComputable&&n(Math.round(t.loaded/t.total*100))},o.send(e)}function s(t,e){var i="\n        mutation ($piece: PieceInput!) {\n            dropPiece(piece: $piece) {\n                piece {\n                    url\n                    title\n                    coverImage(position: 10 withFallback: true) {\n                        url\n                    }\n                }\n            }\n        }";r.graphQLQuery(i,{piece:t},function(t){e("OK"===t.status?{status:"OK",data:t.data.dropPiece.piece}:t)})}var r=i(6);e.uploadResource=n,e.getUrls=o,e.uploadFile=a,e.dropPiece=s},function(t,e,i){"use strict";function n(t,e,i){var n="https://"+a.getAPIDomain()+"/v1/graphql",s=new XMLHttpRequest;s.open("POST",n),s.responseType="json",s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Allihoopa-API-Key",a.getAPIKey());var r=o.getAuthCookie();if(r){var u=JSON.parse(r);s.setRequestHeader("ph-access-token",u.access_token)}s.onload=function(){i(200===s.status?{status:"OK",data:s.response.data}:{status:"ERROR",error:new Error(s.response)})},s.send(JSON.stringify({query:t,variables:e}))}var o=i(3),a=i(2);e.graphQLQuery=n},function(t,e){"use strict";function i(t,e,i,n,o){void 0===t?o.push("Missing "+e):isFinite(t)?t>n?o.push(e+" too high: it must be lower than "+n):t<i&&o.push(e+" too low: it must be higher than "+i):o.push(e+" must be a number")}var n=function(){function t(t){this.stems=t.stems,this.presentation=t.presentation,this.attribution=t.attribution,this.musicalMetadata=t.musicalMetadata;var e=[];if(this.validate(e),e.length)throw new Error("Invalid piece created: "+e.join(", "))}return t.prototype.validate=function(t){this.validateStems(t),this.validatePresentation(t),this.validateAttribution(t),this.validateMusicalMetadata(t)},t.prototype.validateStems=function(t){return this.stems?this.stems.mixStem?void(this.stems.mixStem instanceof Function||t.push("`mixStem` field on `stems` must be a function")):void t.push("Missing `mixStem` field on `stems`"):void t.push("Missing `stems` field")},t.prototype.validatePresentation=function(t){return this.presentation?(this.presentation.title?this.presentation.title.length?this.presentation.title.length>50&&t.push("Field `title` field on `presentation` can not be more than 50 characters"):t.push("Field `title` field on `presentation` can not be empty"):t.push("Missing `title` field on `presentation`"),!this.presentation.coverImage||this.presentation.coverImage instanceof Function||t.push("`coverImage` field on `presentation` must be a function"),void(!this.presentation.preview||this.presentation.preview instanceof Function||t.push("`preview` field on `presentation` must be a function"))):void t.push("Missing `presentation` field")},t.prototype.validateAttribution=function(t){if(this.attribution){var e=this.attribution.basedOnPieces;if(void 0===e)return void t.push("Missing field `basedOnPieces` on `attribution`");if(!(e instanceof Array))return void t.push("`basedOnPieces` field on `attribution` must be an array");for(var i=0;i<e.length;++i)if("string"!=typeof e[i]){t.push("`basedOnPieces` field on `attribution` must be an array of strings");break}}},t.prototype.validateMusicalMetadata=function(t){if(!this.musicalMetadata)return void t.push("Missing field `musicalMetadata`");if(i(this.musicalMetadata.lengthMicroseconds,"field `lengthMicroseconds` of `musicalMetadata`",1,12e8,t),this.musicalMetadata.tempo){var e=this.musicalMetadata.tempo;i(e.fixed,"field `fixed` of `tempo` on `musicalMetadata`",1,999.999,t)}if(this.musicalMetadata.loop){var n=this.musicalMetadata.loop;i(n.startMicroseconds,"field `startMicroseconds` of `loop` on `musicalMetadata`",0,this.musicalMetadata.lengthMicroseconds,t),i(n.endMicroseconds,"field `endMicroseconds` of `loop` on `musicalMetadata`",0,this.musicalMetadata.lengthMicroseconds,t),isFinite(n.startMicroseconds)&&isFinite(n.endMicroseconds)&&n.startMicroseconds>=n.endMicroseconds&&t.push("Field `loop` on `musicalMetadata`: the start must come before the end")}if(this.musicalMetadata.timeSignature){var o=this.musicalMetadata.timeSignature;o.fixed?([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].indexOf(o.fixed.upper)===-1&&t.push("Field `upper` of `fixed` of `timeSignature` on `musicalMetadata` must be an integer between 1 and 16"),[2,4,8,16].indexOf(o.fixed.lower)===-1&&t.push("Field `lower` of `fixed` of `timeSignature` on `musicalMetadata` must be either 2, 4, 8, or 16")):t.push("Field `fixed` of `timeSignature` on `musicalMetadata` must be set")}},t}();e.DropPiece=n}])});